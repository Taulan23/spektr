#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐÐžÐ ÐœÐÐ›Ð˜Ð—ÐžÐ’ÐÐÐÐžÐ™ ÐœÐÐ¢Ð Ð˜Ð¦Ð« ÐžÐ¨Ð˜Ð‘ÐžÐš Ð”Ð›Ð¯ 10% Ð¨Ð£ÐœÐ
"""

import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

def create_normalized_matrix_10_percent():
    """Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð´Ð»Ñ 10% ÑˆÑƒÐ¼Ð°"""
    
    # ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ð° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð´Ð»Ñ 10% ÑˆÑƒÐ¼Ð° (Ð¸Ð· Ð½Ð°ÑˆÐ¸Ñ… Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²)
    confusion_matrix_10_percent = np.array([
        [0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # Ð±ÐµÑ€ÐµÐ·Ð°
        [0.000, 0.700, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.300],  # Ð´ÑƒÐ±
        [0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # ÐµÐ»ÑŒ
        [0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # ÐµÐ»ÑŒ_Ð³Ð¾Ð»ÑƒÐ±Ð°Ñ
        [0.000, 0.000, 0.000, 0.000, 0.867, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.133, 0.000],  # Ð¸Ð²Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.867, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.133],  # ÐºÐ°ÑˆÑ‚Ð°Ð½
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # ÐºÐ»ÐµÐ½
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # ÐºÐ»ÐµÐ½_Ð°Ð¼
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.900, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.100],  # Ð»Ð¸Ð¿Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.833, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.167],  # Ð»Ð¸ÑÑ‚Ð²ÐµÐ½Ð½Ð¸Ñ†Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.867, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.133],  # Ð¾Ñ€ÐµÑ…
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.867, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.133],  # Ð¾ÑÐ¸Ð½Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.033],  # Ñ€ÑÐ±Ð¸Ð½Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.933, 0.000, 0.000, 0.000, 0.000, 0.000, 0.067],  # ÑÐ¸Ñ€ÐµÐ½ÑŒ
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.000, 0.033],  # ÑÐ¾ÑÐ½Ð°
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.000, 0.000, 0.033],  # Ñ‚Ð¾Ð¿Ð¾Ð»ÑŒ_Ð±Ð°Ð»ÑŒÐ·Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.867, 0.000, 0.000, 0.133],  # Ñ‚Ð¾Ð¿Ð¾Ð»ÑŒ_Ñ‡ÐµÑ€Ð½Ñ‹Ð¹
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.000, 0.033],  # Ñ‚ÑƒÑ
        [0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.967, 0.033],  # Ñ‡ÐµÑ€ÐµÐ¼ÑƒÑ…Ð°
        [0.000, 0.300, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.700]   # ÑÑÐµÐ½ÑŒ
    ])
    
    # ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ñ ÐºÐ»Ð°ÑÑÐ¾Ð²
    class_names = [
        'Ð±ÐµÑ€ÐµÐ·Ð°', 'Ð´ÑƒÐ±', 'ÐµÐ»ÑŒ', 'ÐµÐ»ÑŒ_Ð³Ð¾Ð»ÑƒÐ±Ð°Ñ', 'Ð¸Ð²Ð°', 'ÐºÐ°ÑˆÑ‚Ð°Ð½', 'ÐºÐ»ÐµÐ½', 'ÐºÐ»ÐµÐ½_Ð°Ð¼',
        'Ð»Ð¸Ð¿Ð°', 'Ð»Ð¸ÑÑ‚Ð²ÐµÐ½Ð½Ð¸Ñ†Ð°', 'Ð¾Ñ€ÐµÑ…', 'Ð¾ÑÐ¸Ð½Ð°', 'Ñ€ÑÐ±Ð¸Ð½Ð°', 'ÑÐ¸Ñ€ÐµÐ½ÑŒ', 'ÑÐ¾ÑÐ½Ð°',
        'Ñ‚Ð¾Ð¿Ð¾Ð»ÑŒ_Ð±Ð°Ð»ÑŒÐ·Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹', 'Ñ‚Ð¾Ð¿Ð¾Ð»ÑŒ_Ñ‡ÐµÑ€Ð½Ñ‹Ð¹', 'Ñ‚ÑƒÑ', 'Ñ‡ÐµÑ€ÐµÐ¼ÑƒÑ…Ð°', 'ÑÑÐµÐ½ÑŒ'
    ]
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ DataFrame Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
    df_cm = pd.DataFrame(confusion_matrix_10_percent, 
                        index=class_names, 
                        columns=class_names)
    
    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
    plt.figure(figsize=(16, 14))
    plt.rcParams['font.size'] = 10
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÐ¿Ð»Ð¾Ð²ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ
    sns.heatmap(df_cm, 
                annot=True, 
                fmt='.3f', 
                cmap='RdYlBu_r', 
                cbar_kws={'label': 'Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ'},
                square=True,
                linewidths=0.5,
                linecolor='white',
                annot_kws={'size': 8})
    
    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ° Ð¸ Ð¼ÐµÑ‚Ð¾Ðº
    plt.title('ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ð° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Extra Trees (1712 Ð´ÐµÑ€ÐµÐ²ÑŒÐµÐ²)\n10% ÑˆÑƒÐ¼Ð°', 
              fontsize=16, fontweight='bold', pad=20)
    plt.xlabel('ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ', fontsize=12, fontweight='bold')
    plt.ylabel('Ð˜ÑÑ‚Ð¸Ð½Ð½Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ', fontsize=12, fontweight='bold')
    
    # ÐŸÐ¾Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð¼ÐµÑ‚ÐºÐ¸ Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ¹ Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸
    plt.xticks(rotation=45, ha='right')
    plt.yticks(rotation=0)
    
    # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸
    accuracy = np.trace(confusion_matrix_10_percent) / len(confusion_matrix_10_percent) * 100
    plt.figtext(0.5, 0.02, 
                f'ÐžÐ±Ñ‰Ð°Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ: {accuracy:.1f}% | Extra Trees (n_estimators=1712) | 10% ÑˆÑƒÐ¼Ð°',
                ha='center', fontsize=12, fontweight='bold',
                bbox=dict(boxstyle="round,pad=0.3", facecolor="lightblue", alpha=0.7))
    
    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¼Ð°ÐºÐµÑ‚Ð°
    plt.tight_layout()
    plt.subplots_adjust(bottom=0.1)
    
    # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ
    filename = 'normalized_confusion_matrix_10_percent_noise.png'
    plt.savefig(filename, dpi=300, bbox_inches='tight', facecolor='white')
    print(f"âœ… ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð°: {filename}")
    
    # ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ
    plt.show()
    
    # Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ
    print(f"\nðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ ÐœÐÐ¢Ð Ð˜Ð¦Ð«:")
    print(f"   â€¢ ÐžÐ±Ñ‰Ð°Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ: {accuracy:.1f}%")
    print(f"   â€¢ Ð Ð°Ð·Ð¼ÐµÑ€ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹: {confusion_matrix_10_percent.shape}")
    print(f"   â€¢ ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ»Ð°ÑÑÐ¾Ð²: {len(class_names)}")
    
    # ÐÐ½Ð°Ð»Ð¸Ð· Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
    print(f"\nðŸ” ÐžÐ¡ÐÐžÐ’ÐÐ«Ð• ÐžÐ¨Ð˜Ð‘ÐšÐ˜:")
    for i, class_name in enumerate(class_names):
        correct = confusion_matrix_10_percent[i, i]
        errors = 1 - correct
        if errors > 0.05:  # ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
            print(f"   â€¢ {class_name}: {errors:.1%} Ð¾ÑˆÐ¸Ð±Ð¾Ðº")

if __name__ == "__main__":
    create_normalized_matrix_10_percent() 